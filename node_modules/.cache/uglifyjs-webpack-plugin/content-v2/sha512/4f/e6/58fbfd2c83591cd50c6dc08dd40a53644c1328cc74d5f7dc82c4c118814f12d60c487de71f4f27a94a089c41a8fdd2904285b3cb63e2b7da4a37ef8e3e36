{"code":"/*!\n * This software is licensed under a BSD license; see the LICENSE file for details.\n * \n *  - Version beta 0.4\n *  - Last Update:  2018, September 11\n *  - Major changes in beta 0.4:\n *     * Fixed a bug with FeedItems in group designs, no longer relies on latin squares (setItems now obsolete)\n *     * Fixed 'invalid format' bug with FeedItems(PennController.defaultTable)\n *     * FeedItems no longer gets overridden by later definitions of 'items'\n *     * FeedItems no longer generates items for non-running groups (preventing unnecessarily loading unused resources)\n *     * Fixed a bug that made selector.select inoperative\n *     * Fixed a bug that made selector.settings.once break selector.wait\n *     + Can now upload CSV tables directly to chunk_includes\n *     + Added a \"Loading, please wait\" message\n *     + Added .label to FeedItems, to define constant string labels (useful when reusing spreadsheets)\n *     + Added .setLabelColumn, .setGroupColumn and .setItemColumn to GetTable (setLabel, setGroup and setItem now deprecated)\n *     + Added log entries to report even when no element-specific event happen\n *     + Added element type Video\n *     + Added test command .index for Selector\n *     + Added options for scale.settings.log (last, first, etc.)\n */!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,\"__esModule\",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=69)}({0:function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return r});var r={resources:{list:[],fetch:function(e,t,n){n=void 0==n|1==n;var o=r.resources.list.filter(t=>t.name==e&&t.controllers.indexOf(r.controllers.underConstruction.id)<0);if((o=o.length?o[0]:new class{constructor(e,t){this.name=e,this.value=e,this.creator=t,this.controllers=[],this.object=null,this.status=\"void\"}create(){this.status=\"pending\",this.creator.apply(this,[()=>this.resolve()])}resolve(){this.status=\"ready\"}}(e,t)).controllers.push(r.controllers.underConstruction.id),r.controllers.underConstruction.resources.push(o),\"void\"!=o.status)return o;if(o.creator=t,o.create(),n)for(let t in r.URLs)o.create.apply($.extend({},o,{value:r.URLs[t]+e,resolve:function(){\"ready\"!=o.status&&(o.object=this.object,o.resolve())}}));return r.resources.list.push(o),o}},controllers:{list:[],running:null,underConstruction:null},elements:{list:[]},URLs:[],utils:{}}},1:function(e,t,n){\"use strict\";function r(e){return()=>new Promise(async function(t){for(let t in e)if(e[t]instanceof Function)var n=await e[t]();t(n)})}function o(e){let t=[];return new Uint8Array(e).forEach(e=>{t.push(e.toString(16))}),t.join(\"\").toUpperCase()}function i(e){return e.match(/^00000[12]00/)?\"image/x-icon\":e.match(/424D/)?\"image/bmp\":e.match(/^89504E470D0A1A0A/)?\"image/png\":e.match(/^474946383[79]61/)?\"image/gif\":e.match(/^52494646........574542505650/)?\"image/webp\":e.match(/^FFD8FF/)?\"image/jpeg\":e.match(/^2E736E64/)?\"audio/basic\":e.match(/^464F524D........41494646/)?\"audio/aiff\":e.match(/^(fffb|494433)/)?\"audio/mpeg\":e.match(/^4F67675300/)?\"application/ogg\":e.match(/^4D546864......06/)?\"audio/midi\":e.match(/^52494646........41564920/)?\"video/avi\":e.match(/^52494646......(..)?57415645/)?\"audio/wave\":e.match(/^1A45DFA3/)?\"video/webm\":e.match(/^25504446/)?\"application/pdf\":!!e.match(/^504B0304/)&&\"application/zip\"}function s(e){let t=e/1e3%60,n=Math.trunc(e/6e4);return(n>0?n+\"min\":\"\")+(t>0?t+\"s\":\"\")}n.d(t,\"c\",function(){return r}),n.d(t,\"b\",function(){return o}),n.d(t,\"a\",function(){return i}),n.d(t,\"d\",function(){return s})},2:function(e,t,n){\"use strict\";n.r(t),n.d(t,\"PennController\",function(){return u});var r=n(0),o=n(1);const i=6e4;let s=null,a=null;class l{constructor(){if(this.id=r.a.controllers.list.length,this.appendResultLine=[],this.linesToSave=[],this.resources=[],this.elements={},this.preloadDelay=i,r.a.controllers.list.push(this),this.defaultCommands={},this.headerDefaultCommands={},s&&s.defaultCommands)for(let e in s.defaultCommands)this.defaultCommands[e]=[].concat(s.defaultCommands[e])}_addElement(e,t){this.elements.hasOwnProperty(e)&&console.warn(\"Overriding another element with the same name (\"+e+\") in PennController #\"+this.id),this.elements[e]=t}_getElement(e){return this.elements[e]?this.elements[e]:console.warn(\"No element named \"+e+\" found for current controller\")}logAppend(e,t,n){return this.linesToSave.push([\"PennController\",this.id,e,t,Date.now(),n]),this}log(e,t){return void 0==t&&(t=e),this.appendResultLine.push([e,t]),this}noHeader(){return this.runHeader=!1,this}noFooter(){return this.runFooter=!1,this}setOption(e,t){this[e]=t}}r.a.controllers.underConstruction=new l,r.a.controllers.new=(()=>new l);var u=function(...e){let t=r.a.controllers.underConstruction,n=[];return function e(...t){for(let n in t)t[n]._promises?this.push(Object(o.c)(t[n]._promises)):t[n]instanceof Array&&e.apply(this,t[n])}.apply(n,e),t.sequence=Object(o.c)(n),r.a.controllers.underConstruction=new l,t};let c={};u.GetURLParameter=function(e){if(!Object.keys(c).length){let e=window.location.search.replace(\"?\",\"\").split(\"&\");for(let t in e)c[e[t].split(\"=\")[0]]=e[t].split(\"=\")[1]}if(c.hasOwnProperty(e))return c[e]},u.AddHost=function(...e){for(let t in e)\"string\"==typeof e[t]&&e[t].match(/^https?:\\/\\//i)?r.a.URLs.push(e[t]):console.warn(\"URL #\"+t+\" is not a valid URL (PennController.AddHost).\",e[t])},u.CheckPreloaded=function(...e){let t=new l;t.id=\"Preloader\",t.runHeader=!1,t.runFooter=!1,r.a.controllers.list.pop(),t.sequence=(()=>new Promise(e=>e())),t.ignoreWhenCheckingPreload=!0,e.length&&Number(e[e.length-1])>0&&(t.preloadDelay=Number(e[e.length-1]),e.length>1&&e.pop());let n=[];if(e.length)for(let t in e){let r=e[t];\"string\"==typeof r&&(r=(n=>n==e[t])),r instanceof Function&&n.push(r)}else n=[anyType];let o=window.modifyRunningOrder;return window.modifyRunningOrder=function(e){o instanceof Function&&(e=o.call(this,e));for(let r=0;r<e.length;r++){let o=e[r].filter(e=>{let t=!1;for(let r in n)t=t||n[r](e.type);t=(t=t&&\"PennController\"==e.controller)&&!e.options.ignoreWhenCheckingPreload});for(let e in o)t.resources=t.resources.concat(element[e].resources.filter(e=>t.resources.indexOf(e)<0))}return e},t},u.Header=function(...e){let t=r.a.controllers.underConstruction;t.id=\"Header\",r.a.controllers.list.pop(),t.sequence=Object(o.c)(e.map(e=>Object(o.c)(e._promises)));for(let e in t.defaultCommands)for(let n in t.defaultCommands[e])t.defaultCommands[e][n].push(\"header\");return s=t,r.a.controllers.underConstruction=new l,t},u.Footer=function(...e){let t=r.a.controllers.underConstruction;return t.id=\"Footer\",r.a.controllers.list.pop(),t.sequence=Object(o.c)(e.map(e=>Object(o.c)(e._promises))),a=t,r.a.controllers.underConstruction=new l,t},define_ibex_controller({name:\"PennController\",jqueryWidget:{_init:function(){var e=this;r.a.controllers.running=e,e.cssPrefix=e.options._cssPrefix,e.utils=e.options._utils,e.finishedCallback=e.options._finishedCallback,e.id=e.options.id,e.runHeader=void 0==e.options.runHeader|e.options.runHeader,e.runFooter=void 0==e.options.runFooter|e.options.runFooter;let t=e.options.preloadDelay,n=[];e.save=function(t,r,o,i,s,...a){a.length||(a=[\"NULL\"]);let l=[[\"PennElementType\",t],[\"PennElementName\",r],[\"Parameter\",o],[\"Value\",i],[\"EventTime\",s]];if(e.options.appendResultLine instanceof Array)for(let t in e.options.appendResultLine){let n=e.options.appendResultLine[t];n instanceof Array&&2==n.length&&l.push(n)}l.push([\"Comments\",a.join(\",\")]),n.push(l)};for(let t in e.options.linesToSave)e.save(e.options.linesToSave[t]);e.runHeader&&s instanceof l&&(e.options.resources=e.options.resources.concat(s.resources.filter(t=>e.options.resources.indexOf(t)<0)),$.extend(e.options.elements,s.elements)),e.runFooter&&a instanceof l&&(e.options.resources=e.options.resources.concat(a.resources.filter(t=>e.options.resources.indexOf(t)<0)),$.extend(e.options.elements,a.elements));let i=!1,u=async function(){if(!i){i=!0,e.runFooter&&a instanceof l&&(e.save(\"PennController\",e.id,\"_Footer_\",\"Start\",Date.now(),\"NULL\"),await a.sequence(),e.save(\"PennController\",e.id,\"_Footer_\",\"End\",Date.now(),\"NULL\"));for(let t in e.options.elements)e.options.elements[t].end();e.save(\"PennController\",e.id,\"_Trial_\",\"End\",Date.now(),\"NULL\"),n.sort((e,t)=>e[4][1]>t[4][1]),n.map(e=>{for(let t in e)e[t][1]instanceof Function?e[t][1]=e[t][1]():e[t][1]&&\"Var\"==e[t][1].type&&(e[t][1]=e[t][1].value)}),e.finishedCallback(n)}};e.endTrial=u;let c=!1,h=async function(t){if(!c){if(c=!0,t)for(let t in e.options.resources.filter(e=>\"ready\"!=e.status))e.save(\"PennController\",e.id,\"_PreloadFailed_\",csv_url_encode(e.options.resources[t].name),Date.now(),\"NULL\");e.save(\"PennController\",e.id,\"_Trial_\",\"Start\",Date.now(),\"NULL\"),e.runHeader&&s instanceof l&&(e.save(\"PennController\",e.id,\"_Header_\",\"Start\",Date.now(),\"NULL\"),await s.sequence(),e.save(\"PennController\",e.id,\"_Header_\",\"End\",Date.now(),\"NULL\")),d.remove(),e.options.sequence().then(u)}},d=$(\"<div><p>Please wait while the resources are preloading</p><p>This may take up to \"+Object(o.d)(t)+\".</p></div>\");e.element.append(d);for(let t in e.options.resources){let n=e.options.resources[t],r=n.resolve;\"ready\"!=n.status&&(n.resolve=function(){r.apply(n),0==e.options.resources.filter(e=>\"ready\"!=e.status).length&&h()})}0==e.options.resources.filter(e=>\"ready\"!=e.status).length?h():setTimeout(function(){h(!0)},t)}},properties:{obligatory:[],countsForProgressBar:!0,htmlDescription:null}})},69:function(e,t,n){(function(e){e._AddElementType(\"Html\",function(e){function t(e,t){var n=$(\"label.error[for=__ALL_FIELDS__]\");if(n.length>0)n.addClass(\"Form-error-text\").text(t);else{var r=$(\"label.error[for=\"+escape(e)+\"]\");r.length>0?r.addClass(\"Form-error-text\").text(t):alert(t)}}function n(){for(var e=this.jQueryElement[0],t=$(e).find(\"input[type=text]\"),n=$(e).find(\"textarea\"),r=0;r<n.length;++r)t.push(n[r]);for(r=0;r<t.length;++r){var o=$(t[r]);if(o.hasClass(\"obligatory\")&&(!o.attr(\"value\")||o.attr(\"value\").match(/^\\s*$/)))return!1}var i=$(e).find(\"input[type=checkbox]\");for(r=0;r<i.length;++r){var s=$(i[r]);if(!s.attr(\"checked\")&&s.hasClass(\"obligatory\"))return!1}var a=$(e).find(\"input[type=radio]\"),l={};for(r=0;r<a.length;++r){var u=$(a[r]);u.attr(\"name\")&&(l[u.attr(\"name\")]||(l[u.attr(\"name\")]=[]),l[u.attr(\"name\")].push(u))}for(var c in l){var h=!1,d=!1;for(r=0;r<l[c].length;++r)l[c][r].hasClass(\"obligatory\")&&(h=!0),l[c][r].attr(\"checked\")&&(d=!0);if(h&&!d)return!1}return!0}this.immediate=function(e,t){this.html=t},this.uponCreation=function(e){CHUNKS_DICT.hasOwnProperty(this.html)?this.jQueryElement=$(\"<div>\").html(htmlCodeToDOM({include:this.html})):this.jQueryElement=$(\"<div>\").html(this.html),this.log=!1,e()},this.end=function(){if(this.log){for(var t=this.jQueryElement[0],n=$(t).find(\"input[type=text]\"),r=$(t).find(\"textarea\"),o=0;o<r.length;++o)n.push(r[o]);for(o=0;o<n.length;++o){var i=$(n[o]);e.controllers.running.save(this.type,this.id,csv_url_encode(i.attr(\"value\")),csv_url_encode(i.attr(\"name\")),Date.now(),\"text input\")}var s=$(t).find(\"input[type=checkbox]\");for(o=0;o<s.length;++o){var a=$(s[o]);e.controllers.running.save(this.type,this.id,a.attr(\"name\"),a.attr(\"checked\")?\"checked\":\"unchecked\",Date.now(),\"checkbox\")}var l=$(t).find(\"input[type=radio]\"),u={};for(o=0;o<l.length;++o){var c=$(l[o]);c.attr(\"name\")&&(u[c.attr(\"name\")]||(u[c.attr(\"name\")]=[]),u[c.attr(\"name\")].push(c))}for(var h in u){var d,f=!1;for(o=0;o<u[h].length;++o)u[h][o].attr(\"checked\")&&(f=!0,d=o);f&&e.controllers.running.save(this.type,this.id,u[h][0].attr(\"name\"),u[h][d].attr(\"value\"),Date.now(),\"radio button\")}}},this.value=function(){return n.apply(this)},this.actions={warn:function(e){for(var n=this.jQueryElement[0],r=$(n).find(\"input[type=text]\"),o=$(n).find(\"textarea\"),i=0;i<o.length;++i)r.push(o[i]);for(i=0;i<r.length;++i){var s=$(r[i]);!s.hasClass(\"obligatory\")||s.attr(\"value\")&&!s.attr(\"value\").match(/^\\s*$/)||t(s.attr(\"name\"),\"The ‘\"+s.attr(\"name\")+\"’ field is obligatory.\")}var a=$(n).find(\"input[type=checkbox]\");for(i=0;i<a.length;++i){var l=$(a[i]);!l.attr(\"checked\")&&l.hasClass(\"obligatory\")&&t(l.attr(\"name\"),\"You must check the \"+l.attr(\"name\")+\" checkbox to continue.\")}var u=$(n).find(\"input[type=radio]\"),c={};for(i=0;i<u.length;++i){var h=$(u[i]);h.attr(\"name\")&&(c[h.attr(\"name\")]||(c[h.attr(\"name\")]=[]),c[h.attr(\"name\")].push(h))}for(var d in c){var f=!1,p=!1;for(i=0;i<c[d].length;++i)c[d][i].hasClass(\"obligatory\")&&(f=!0),c[d][i].attr(\"checked\")&&(p=!0);f&&!p&&t(c[d][0].attr(\"name\"),\"You must select an option for ‘\"+c[d][0].attr(\"name\")+\"’.\")}e()}},this.settings={log:function(e){this.log=!0,e()}},this.test={complete:function(){return n.apply(this)}}})}).call(this,n(2).PennController)}});","extractedComments":[]}