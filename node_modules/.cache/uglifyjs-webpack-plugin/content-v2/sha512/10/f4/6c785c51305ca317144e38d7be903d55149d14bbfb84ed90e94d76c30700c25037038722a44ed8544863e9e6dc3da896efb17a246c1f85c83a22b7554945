{"code":"/*!\n * This software is licensed under a BSD license; see the LICENSE file for details.\n * \n *  - Version beta 0.4\n *  - Last Update:  2018, September 11\n *  - Major changes in beta 0.4:\n *     * Fixed a bug with FeedItems in group designs, no longer relies on latin squares (setItems now obsolete)\n *     * Fixed 'invalid format' bug with FeedItems(PennController.defaultTable)\n *     * FeedItems no longer gets overridden by later definitions of 'items'\n *     * FeedItems no longer generates items for non-running groups (preventing unnecessarily loading unused resources)\n *     * Fixed a bug that made selector.select inoperative\n *     * Fixed a bug that made selector.settings.once break selector.wait\n *     + Can now upload CSV tables directly to chunk_includes\n *     + Added a \"Loading, please wait\" message\n *     + Added .label to FeedItems, to define constant string labels (useful when reusing spreadsheets)\n *     + Added .setLabelColumn, .setGroupColumn and .setItemColumn to GetTable (setLabel, setGroup and setItem now deprecated)\n *     + Added log entries to report even when no element-specific event happen\n *     + Added element type Video\n *     + Added test command .index for Selector\n *     + Added options for scale.settings.log (last, first, etc.)\n */!function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},n.r=function(e){Object.defineProperty(e,\"__esModule\",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=65)}({0:function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return s});var s={resources:{list:[],fetch:function(e,t,n){n=void 0==n|1==n;var i=s.resources.list.filter(t=>t.name==e&&t.controllers.indexOf(s.controllers.underConstruction.id)<0);if((i=i.length?i[0]:new class{constructor(e,t){this.name=e,this.value=e,this.creator=t,this.controllers=[],this.object=null,this.status=\"void\"}create(){this.status=\"pending\",this.creator.apply(this,[()=>this.resolve()])}resolve(){this.status=\"ready\"}}(e,t)).controllers.push(s.controllers.underConstruction.id),s.controllers.underConstruction.resources.push(i),\"void\"!=i.status)return i;if(i.creator=t,i.create(),n)for(let t in s.URLs)i.create.apply($.extend({},i,{value:s.URLs[t]+e,resolve:function(){\"ready\"!=i.status&&(i.object=this.object,i.resolve())}}));return s.resources.list.push(i),i}},controllers:{list:[],running:null,underConstruction:null},elements:{list:[]},URLs:[],utils:{}}},1:function(e,t,n){\"use strict\";function s(e){return()=>new Promise(async function(t){for(let t in e)if(e[t]instanceof Function)var n=await e[t]();t(n)})}function i(e){let t=[];return new Uint8Array(e).forEach(e=>{t.push(e.toString(16))}),t.join(\"\").toUpperCase()}function o(e){return e.match(/^00000[12]00/)?\"image/x-icon\":e.match(/424D/)?\"image/bmp\":e.match(/^89504E470D0A1A0A/)?\"image/png\":e.match(/^474946383[79]61/)?\"image/gif\":e.match(/^52494646........574542505650/)?\"image/webp\":e.match(/^FFD8FF/)?\"image/jpeg\":e.match(/^2E736E64/)?\"audio/basic\":e.match(/^464F524D........41494646/)?\"audio/aiff\":e.match(/^(fffb|494433)/)?\"audio/mpeg\":e.match(/^4F67675300/)?\"application/ogg\":e.match(/^4D546864......06/)?\"audio/midi\":e.match(/^52494646........41564920/)?\"video/avi\":e.match(/^52494646......(..)?57415645/)?\"audio/wave\":e.match(/^1A45DFA3/)?\"video/webm\":e.match(/^25504446/)?\"application/pdf\":!!e.match(/^504B0304/)&&\"application/zip\"}function r(e){let t=e/1e3%60,n=Math.trunc(e/6e4);return(n>0?n+\"min\":\"\")+(t>0?t+\"s\":\"\")}n.d(t,\"c\",function(){return s}),n.d(t,\"b\",function(){return i}),n.d(t,\"a\",function(){return o}),n.d(t,\"d\",function(){return r})},2:function(e,t,n){\"use strict\";n.r(t),n.d(t,\"PennController\",function(){return a});var s=n(0),i=n(1);const o=6e4;let r=null,l=null;class c{constructor(){if(this.id=s.a.controllers.list.length,this.appendResultLine=[],this.linesToSave=[],this.resources=[],this.elements={},this.preloadDelay=o,s.a.controllers.list.push(this),this.defaultCommands={},this.headerDefaultCommands={},r&&r.defaultCommands)for(let e in r.defaultCommands)this.defaultCommands[e]=[].concat(r.defaultCommands[e])}_addElement(e,t){this.elements.hasOwnProperty(e)&&console.warn(\"Overriding another element with the same name (\"+e+\") in PennController #\"+this.id),this.elements[e]=t}_getElement(e){return this.elements[e]?this.elements[e]:console.warn(\"No element named \"+e+\" found for current controller\")}logAppend(e,t,n){return this.linesToSave.push([\"PennController\",this.id,e,t,Date.now(),n]),this}log(e,t){return void 0==t&&(t=e),this.appendResultLine.push([e,t]),this}noHeader(){return this.runHeader=!1,this}noFooter(){return this.runFooter=!1,this}setOption(e,t){this[e]=t}}s.a.controllers.underConstruction=new c,s.a.controllers.new=(()=>new c);var a=function(...e){let t=s.a.controllers.underConstruction,n=[];return function e(...t){for(let n in t)t[n]._promises?this.push(Object(i.c)(t[n]._promises)):t[n]instanceof Array&&e.apply(this,t[n])}.apply(n,e),t.sequence=Object(i.c)(n),s.a.controllers.underConstruction=new c,t};let u={};a.GetURLParameter=function(e){if(!Object.keys(u).length){let e=window.location.search.replace(\"?\",\"\").split(\"&\");for(let t in e)u[e[t].split(\"=\")[0]]=e[t].split(\"=\")[1]}if(u.hasOwnProperty(e))return u[e]},a.AddHost=function(...e){for(let t in e)\"string\"==typeof e[t]&&e[t].match(/^https?:\\/\\//i)?s.a.URLs.push(e[t]):console.warn(\"URL #\"+t+\" is not a valid URL (PennController.AddHost).\",e[t])},a.CheckPreloaded=function(...e){let t=new c;t.id=\"Preloader\",t.runHeader=!1,t.runFooter=!1,s.a.controllers.list.pop(),t.sequence=(()=>new Promise(e=>e())),t.ignoreWhenCheckingPreload=!0,e.length&&Number(e[e.length-1])>0&&(t.preloadDelay=Number(e[e.length-1]),e.length>1&&e.pop());let n=[];if(e.length)for(let t in e){let s=e[t];\"string\"==typeof s&&(s=(n=>n==e[t])),s instanceof Function&&n.push(s)}else n=[anyType];let i=window.modifyRunningOrder;return window.modifyRunningOrder=function(e){i instanceof Function&&(e=i.call(this,e));for(let s=0;s<e.length;s++){let i=e[s].filter(e=>{let t=!1;for(let s in n)t=t||n[s](e.type);t=(t=t&&\"PennController\"==e.controller)&&!e.options.ignoreWhenCheckingPreload});for(let e in i)t.resources=t.resources.concat(element[e].resources.filter(e=>t.resources.indexOf(e)<0))}return e},t},a.Header=function(...e){let t=s.a.controllers.underConstruction;t.id=\"Header\",s.a.controllers.list.pop(),t.sequence=Object(i.c)(e.map(e=>Object(i.c)(e._promises)));for(let e in t.defaultCommands)for(let n in t.defaultCommands[e])t.defaultCommands[e][n].push(\"header\");return r=t,s.a.controllers.underConstruction=new c,t},a.Footer=function(...e){let t=s.a.controllers.underConstruction;return t.id=\"Footer\",s.a.controllers.list.pop(),t.sequence=Object(i.c)(e.map(e=>Object(i.c)(e._promises))),l=t,s.a.controllers.underConstruction=new c,t},define_ibex_controller({name:\"PennController\",jqueryWidget:{_init:function(){var e=this;s.a.controllers.running=e,e.cssPrefix=e.options._cssPrefix,e.utils=e.options._utils,e.finishedCallback=e.options._finishedCallback,e.id=e.options.id,e.runHeader=void 0==e.options.runHeader|e.options.runHeader,e.runFooter=void 0==e.options.runFooter|e.options.runFooter;let t=e.options.preloadDelay,n=[];e.save=function(t,s,i,o,r,...l){l.length||(l=[\"NULL\"]);let c=[[\"PennElementType\",t],[\"PennElementName\",s],[\"Parameter\",i],[\"Value\",o],[\"EventTime\",r]];if(e.options.appendResultLine instanceof Array)for(let t in e.options.appendResultLine){let n=e.options.appendResultLine[t];n instanceof Array&&2==n.length&&c.push(n)}c.push([\"Comments\",l.join(\",\")]),n.push(c)};for(let t in e.options.linesToSave)e.save(e.options.linesToSave[t]);e.runHeader&&r instanceof c&&(e.options.resources=e.options.resources.concat(r.resources.filter(t=>e.options.resources.indexOf(t)<0)),$.extend(e.options.elements,r.elements)),e.runFooter&&l instanceof c&&(e.options.resources=e.options.resources.concat(l.resources.filter(t=>e.options.resources.indexOf(t)<0)),$.extend(e.options.elements,l.elements));let o=!1,a=async function(){if(!o){o=!0,e.runFooter&&l instanceof c&&(e.save(\"PennController\",e.id,\"_Footer_\",\"Start\",Date.now(),\"NULL\"),await l.sequence(),e.save(\"PennController\",e.id,\"_Footer_\",\"End\",Date.now(),\"NULL\"));for(let t in e.options.elements)e.options.elements[t].end();e.save(\"PennController\",e.id,\"_Trial_\",\"End\",Date.now(),\"NULL\"),n.sort((e,t)=>e[4][1]>t[4][1]),n.map(e=>{for(let t in e)e[t][1]instanceof Function?e[t][1]=e[t][1]():e[t][1]&&\"Var\"==e[t][1].type&&(e[t][1]=e[t][1].value)}),e.finishedCallback(n)}};e.endTrial=a;let u=!1,d=async function(t){if(!u){if(u=!0,t)for(let t in e.options.resources.filter(e=>\"ready\"!=e.status))e.save(\"PennController\",e.id,\"_PreloadFailed_\",csv_url_encode(e.options.resources[t].name),Date.now(),\"NULL\");e.save(\"PennController\",e.id,\"_Trial_\",\"Start\",Date.now(),\"NULL\"),e.runHeader&&r instanceof c&&(e.save(\"PennController\",e.id,\"_Header_\",\"Start\",Date.now(),\"NULL\"),await r.sequence(),e.save(\"PennController\",e.id,\"_Header_\",\"End\",Date.now(),\"NULL\")),h.remove(),e.options.sequence().then(a)}},h=$(\"<div><p>Please wait while the resources are preloading</p><p>This may take up to \"+Object(i.d)(t)+\".</p></div>\");e.element.append(h);for(let t in e.options.resources){let n=e.options.resources[t],s=n.resolve;\"ready\"!=n.status&&(n.resolve=function(){s.apply(n),0==e.options.resources.filter(e=>\"ready\"!=e.status).length&&d()})}0==e.options.resources.filter(e=>\"ready\"!=e.status).length?d():setTimeout(function(){d(!0)},t)}},properties:{obligatory:[],countsForProgressBar:!0,htmlDescription:null}})},65:function(e,t,n){(function(e){e._AddElementType(\"Selector\",function(t){function n(e,...n){let s=[];if(n.length)for(let e in n){if(!(n._element&&n._element.jQueryElement instanceof jQuery)){console.warn(\"Invalid element #\"+e+\" in shuffling selector \"+this.id+\" in PennController #\"+t.controllers.running.id);continue}let i=this.elements.map(e=>e[0]).indexOf(n._element);i<0?console.warn(\"Cannot shuffle element \"+element.id+\" for it has not been added to selector \"+this.id+\" in PennController #\"+t.controllers.running.id):s.push(this.elements[i])}else s=[].concat(this.elements);let i=[].concat(s);fisherYates(i);let o=i.map((e,t)=>Object({old:{element:s[t],index:this.elements.indexOf(s[t])},new:{element:e,index:this.elements.indexOf(e)}})),r=[];o.map((e,t)=>{this.elements[e.old.index]=e.new.element;let n=$(\"<shuffle>\").attr(\"i\",t);e.old.element[0].jQueryElement.before(n),n.css({position:e.old.element[0].jQueryElement.css(\"position\"),left:e.old.element[0].jQueryElement.css(\"left\"),top:e.old.element[0].jQueryElement.css(\"top\")}),r.push(n)}),r.map(e=>{let t=e.attr(\"i\"),n=o[t].new.element[0].jQueryElement;e.after(n),n.css({position:e.css(\"position\"),left:e.css(\"left\"),top:e.css(\"top\")}),this.selections.length&&this.selections[this.selections.length-1][1]==o[t].new.element[0].id&&n.before(this.frame),e.remove()}),e()}this.immediate=function(e){},this.uponCreation=function(e){this.elements=[],this.selections=[],this.disabled=!1,this.frame=$(\"<div>\").css({position:\"absolute\",display:\"inline-block\",border:\"dotted 1px grey\",\"z-index\":100}).addClass(\"PennController-\"+this.type+\"-selectionFrame\"),this.noClick=!1,this.select=(e=>{if(!this.disabled){if(this.elements.map(e=>e[0]).indexOf(e)<0)return console.warn(\"Tried to select an element not part of selector \"+this.id+\" in PennController #\"+t.controllers.running.id);this.selections.push([\"Selection\",e.id,Date.now(),\"NULL\"]),this.frame.css({width:e.jQueryElement.width(),height:e.jQueryElement.height(),\"pointer-events\":\"none\"}),\"absolute\"==e.jQueryElement.css(\"position\")&&this.frame.css({left:e.jQueryElement.css(\"left\"),top:e.jQueryElement.css(\"top\")}),e.jQueryElement.before(this.frame),this.elements.map(e=>e[0].jQueryElement.removeClass(\"PennController-\"+this.type+\"-selected\")),e.jQueryElement.addClass(\"PennController-\"+this.type+\"-selected\")}}),t.controllers.running.safeBind($(document),\"keydown\",e=>{if(!this.disabled)for(let t in this.elements){let n=\"\";if(this.elements[t].length>1&&(n=this.elements[t][1]),n&&\"string\"==typeof n&&n.match(RegExp(String.fromCharCode(e.which),\"i\")))return this.select(this.elements[t][0])}}),e()},this.end=function(){if(this.elements=[],this.frame.remove(),this.log&&this.log instanceof Array)if(this.selections.length)if(1==this.selections.length)t.controllers.running.save(this.type,this.id,...this.selections[0]);else if(this.log.indexOf(\"all\")>-1)for(let e in this.selections)t.controllers.running.save(this.type,this.id,...this.selections[e]);else this.log.indexOf(\"first\")>-1&&t.controllers.running.save(this.type,this.id,...this.selections[0]),this.log.indexOf(\"last\")>-1&&t.controllers.running.save(this.type,this.id,...this.selections[this.selections.length-1]);else t.controllers.running.save(this.type,this.id,\"Selection\",\"NA\",\"Never\",\"No selection happened\")},this.value=function(){if(this.selections.length){let t=this.selections[this.selections.length-1][1];return e.Elements[\"get\"+t.type](t.id)}return null},this.actions={select:function(e,n){if(!isNaN(Number(n))&&Number(n)>=0&&Number(n)<this.elements.length&&(n={_element:this.elements[Number(n)][0]}),n._element&&n._element.jQueryElement instanceof jQuery){let e=this.disabled;this.disabled=!1,this.select(n._element),this.disabled=e}else console.warn(\"Invalid element passed to select command for selector \"+this.id+\" in PennController #\"+t.controllers.running.id);e()},shuffle:function(e,...t){n.apply(this,[e].concat(t))},unselect:function(e){this.selections.push([\"Unselect\",\"Unselect\",Date.now(),\"From script\"]),this.frame.detach(),this.elements.map(e=>e[0].jQueryElement.removeClass(\"PennController-\"+this.type+\"-selected\")),e()},wait:function(e,t){if(\"first\"==t&&this.selections.length)e();else{let n=!1,s=this.select;this.select=(i=>{let o=s.apply(this,[i]);n||this.disable&&!o||(t instanceof Object&&t._runPromises&&t.success?t._runPromises().then(t=>{\"success\"==t&&(n=!0,e())}):(n=!0,e()))})}}},this.settings={add:function(e,...n){for(w in n){let e=n[w]._element;void 0==e||void 0==e.id?console.warn(\"Invalid element added to selector \"+this.id+\" in PennController #\"+t.controllers.running.id):this.elements.map(e=>e[0]).indexOf(e)>-1?console.warn(\"Element \"+e.id+\" already part of selector \"+this.id+\" in PennController #\"+t.controllers.running.id):void 0!=e.jQueryElement&&e.jQueryElement instanceof jQuery?(this.elements.push([e]),this.noClick||e.jQueryElement.css(\"cursor\",\"pointer\"),e.jQueryElement.click(()=>{this.noClick||this.select(e)})):console.warn(\"Element \"+e.id+\" has no visble element to be chosen in selector \"+this.id+\" in PennController #\"+t.controllers.running.id)}e()},callback:function(e,...t){let n=this.select;this.select=async function(e){if(n.apply(this,[e]),!this.disabled)for(let e in t)await t[e]._runPromises()},e()},disable:function(e){this.disabled=!0,this.elements.map(e=>e[0].jQueryElement.css(\"cursor\",\"\")),e()},disableClicks:function(e,t){this.noClick=!0,this.elements.map(e=>e[0].jQueryElement.css(\"cursor\",\"\")),e()},enable:function(e){this.disabled=!1,this.noClick||this.elements.map(e=>e[0].jQueryElement.css(\"cursor\",\"pointer\")),e()},enableClicks:function(e){this.noClick=!1,this.elements.map(e=>e[0].jQueryElement.css(\"cursor\",\"pointer\")),e()},frame:function(e,t){this.frame.css.apply(this.frame,[\"border\",t]),e()},keys:function(e,...t){for(let e in t){if(e>=this.elements.length)break;let n=t[e];Number(n)>0&&(n=String.fromCharCode(n)),this.elements[e]=[this.elements[e][0],n]}e()},log:function(e,...t){t.length?this.log=t:this.log=[\"last\"],e()},once:function(e){if(this.selections.length)this.disabled=!0,this.elements.map(e=>e[0].jQueryElement.css(\"cursor\",\"\"));else{let e=this.select;this.select=(t=>{if(e.apply(this,[t]),!this.disabled)return this.disabled=!0,this.elements.map(e=>e[0].jQueryElement.css(\"cursor\",\"\")),\"once\"})}e()},shuffle:function(e,...t){n.apply(this,[e].concat(t))}},this.test={selected:function(e){return void 0==e?this.selections.length:e._element?this.selections[this.selections.length-1][1]==e._element.id:(console.warn(\"Invalid element tested for selector \"+this.id+\" in PennController #\"+t.controllers.running.id,e._element.id),!1)},index:function(e,n){return void 0==e||void 0==e._element?console.warn(\"Invalid element tested for selector \"+this.id+\" in PennController #\"+t.controllers.running.id,e._element.id):Number(n)>=0?this.elements.map(e=>e[0]).indexOf(e._element)==Number(n):this.elements.map(e=>e[0]).indexOf(e._element)>=0}}}),e._AddStandardCommands(function(e){this.settings={selector:async function(t,n){var s;\"string\"==typeof n?(s=e.controllers.running.options.elements[n])||console.warn(\"No selector found named \"+n+\" for PennController #\"+e.controllers.running.id):n._element&&n._runPromises&&(\"Selector\"==n._element.type?(await n._runPromises(),s=n._element):console.warn(\"Tried to add \"+this.name+\" to an invalid selector in PennController #\"+e.controllers.running.id)),s.elements.map(e=>e[0]).indexOf(this)>-1?console.warn(\"Element \"+this.id+\" already part of selector \"+s.id+\" in PennController #\"+e.controllers.running.id):void 0!=this.jQueryElement&&this.jQueryElement instanceof jQuery?(s.elements.push([this]),this.noClick||this.jQueryElement.css(\"cursor\",\"pointer\"),this.jQueryElement.click(()=>{s.noClick||s.select(this)})):console.warn(\"Element \"+this.id+\" has no visble element to be chosen in selector \"+s.id+\" in PennController #\"+e.controllers.running.id),t()}}})}).call(this,n(2).PennController)}});","extractedComments":[]}