{"code":"/*!\n * This software is licensed under a BSD license; see the LICENSE file for details.\n * \n *  - Version beta 0.4\n *  - Last Update:  2018, September 11\n *  - Major changes in beta 0.4:\n *     * Fixed a bug with FeedItems in group designs, no longer relies on latin squares (setItems now obsolete)\n *     * Fixed 'invalid format' bug with FeedItems(PennController.defaultTable)\n *     * FeedItems no longer gets overridden by later definitions of 'items'\n *     * FeedItems no longer generates items for non-running groups (preventing unnecessarily loading unused resources)\n *     * Fixed a bug that made selector.select inoperative\n *     * Fixed a bug that made selector.settings.once break selector.wait\n *     + Can now upload CSV tables directly to chunk_includes\n *     + Added a \"Loading, please wait\" message\n *     + Added .label to FeedItems, to define constant string labels (useful when reusing spreadsheets)\n *     + Added .setLabelColumn, .setGroupColumn and .setItemColumn to GetTable (setLabel, setGroup and setItem now deprecated)\n *     + Added log entries to report even when no element-specific event happen\n *     + Added element type Video\n *     + Added test command .index for Selector\n *     + Added options for scale.settings.log (last, first, etc.)\n */!function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.r=function(e){Object.defineProperty(e,\"__esModule\",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,\"a\",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p=\"\",t(t.s=70)}({0:function(e,n,t){\"use strict\";t.d(n,\"a\",function(){return o});var o={resources:{list:[],fetch:function(e,n,t){t=void 0==t|1==t;var r=o.resources.list.filter(n=>n.name==e&&n.controllers.indexOf(o.controllers.underConstruction.id)<0);if((r=r.length?r[0]:new class{constructor(e,n){this.name=e,this.value=e,this.creator=n,this.controllers=[],this.object=null,this.status=\"void\"}create(){this.status=\"pending\",this.creator.apply(this,[()=>this.resolve()])}resolve(){this.status=\"ready\"}}(e,n)).controllers.push(o.controllers.underConstruction.id),o.controllers.underConstruction.resources.push(r),\"void\"!=r.status)return r;if(r.creator=n,r.create(),t)for(let n in o.URLs)r.create.apply($.extend({},r,{value:o.URLs[n]+e,resolve:function(){\"ready\"!=r.status&&(r.object=this.object,r.resolve())}}));return o.resources.list.push(r),r}},controllers:{list:[],running:null,underConstruction:null},elements:{list:[]},URLs:[],utils:{}}},1:function(e,n,t){\"use strict\";function o(e){return()=>new Promise(async function(n){for(let n in e)if(e[n]instanceof Function)var t=await e[n]();n(t)})}function r(e){let n=[];return new Uint8Array(e).forEach(e=>{n.push(e.toString(16))}),n.join(\"\").toUpperCase()}function i(e){return e.match(/^00000[12]00/)?\"image/x-icon\":e.match(/424D/)?\"image/bmp\":e.match(/^89504E470D0A1A0A/)?\"image/png\":e.match(/^474946383[79]61/)?\"image/gif\":e.match(/^52494646........574542505650/)?\"image/webp\":e.match(/^FFD8FF/)?\"image/jpeg\":e.match(/^2E736E64/)?\"audio/basic\":e.match(/^464F524D........41494646/)?\"audio/aiff\":e.match(/^(fffb|494433)/)?\"audio/mpeg\":e.match(/^4F67675300/)?\"application/ogg\":e.match(/^4D546864......06/)?\"audio/midi\":e.match(/^52494646........41564920/)?\"video/avi\":e.match(/^52494646......(..)?57415645/)?\"audio/wave\":e.match(/^1A45DFA3/)?\"video/webm\":e.match(/^25504446/)?\"application/pdf\":!!e.match(/^504B0304/)&&\"application/zip\"}function s(e){let n=e/1e3%60,t=Math.trunc(e/6e4);return(t>0?t+\"min\":\"\")+(n>0?n+\"s\":\"\")}t.d(n,\"c\",function(){return o}),t.d(n,\"b\",function(){return r}),t.d(n,\"a\",function(){return i}),t.d(n,\"d\",function(){return s})},2:function(e,n,t){\"use strict\";t.r(n),t.d(n,\"PennController\",function(){return c});var o=t(0),r=t(1);const i=6e4;let s=null,l=null;class a{constructor(){if(this.id=o.a.controllers.list.length,this.appendResultLine=[],this.linesToSave=[],this.resources=[],this.elements={},this.preloadDelay=i,o.a.controllers.list.push(this),this.defaultCommands={},this.headerDefaultCommands={},s&&s.defaultCommands)for(let e in s.defaultCommands)this.defaultCommands[e]=[].concat(s.defaultCommands[e])}_addElement(e,n){this.elements.hasOwnProperty(e)&&console.warn(\"Overriding another element with the same name (\"+e+\") in PennController #\"+this.id),this.elements[e]=n}_getElement(e){return this.elements[e]?this.elements[e]:console.warn(\"No element named \"+e+\" found for current controller\")}logAppend(e,n,t){return this.linesToSave.push([\"PennController\",this.id,e,n,Date.now(),t]),this}log(e,n){return void 0==n&&(n=e),this.appendResultLine.push([e,n]),this}noHeader(){return this.runHeader=!1,this}noFooter(){return this.runFooter=!1,this}setOption(e,n){this[e]=n}}o.a.controllers.underConstruction=new a,o.a.controllers.new=(()=>new a);var c=function(...e){let n=o.a.controllers.underConstruction,t=[];return function e(...n){for(let t in n)n[t]._promises?this.push(Object(r.c)(n[t]._promises)):n[t]instanceof Array&&e.apply(this,n[t])}.apply(t,e),n.sequence=Object(r.c)(t),o.a.controllers.underConstruction=new a,n};let u={};c.GetURLParameter=function(e){if(!Object.keys(u).length){let e=window.location.search.replace(\"?\",\"\").split(\"&\");for(let n in e)u[e[n].split(\"=\")[0]]=e[n].split(\"=\")[1]}if(u.hasOwnProperty(e))return u[e]},c.AddHost=function(...e){for(let n in e)\"string\"==typeof e[n]&&e[n].match(/^https?:\\/\\//i)?o.a.URLs.push(e[n]):console.warn(\"URL #\"+n+\" is not a valid URL (PennController.AddHost).\",e[n])},c.CheckPreloaded=function(...e){let n=new a;n.id=\"Preloader\",n.runHeader=!1,n.runFooter=!1,o.a.controllers.list.pop(),n.sequence=(()=>new Promise(e=>e())),n.ignoreWhenCheckingPreload=!0,e.length&&Number(e[e.length-1])>0&&(n.preloadDelay=Number(e[e.length-1]),e.length>1&&e.pop());let t=[];if(e.length)for(let n in e){let o=e[n];\"string\"==typeof o&&(o=(t=>t==e[n])),o instanceof Function&&t.push(o)}else t=[anyType];let r=window.modifyRunningOrder;return window.modifyRunningOrder=function(e){r instanceof Function&&(e=r.call(this,e));for(let o=0;o<e.length;o++){let r=e[o].filter(e=>{let n=!1;for(let o in t)n=n||t[o](e.type);n=(n=n&&\"PennController\"==e.controller)&&!e.options.ignoreWhenCheckingPreload});for(let e in r)n.resources=n.resources.concat(element[e].resources.filter(e=>n.resources.indexOf(e)<0))}return e},n},c.Header=function(...e){let n=o.a.controllers.underConstruction;n.id=\"Header\",o.a.controllers.list.pop(),n.sequence=Object(r.c)(e.map(e=>Object(r.c)(e._promises)));for(let e in n.defaultCommands)for(let t in n.defaultCommands[e])n.defaultCommands[e][t].push(\"header\");return s=n,o.a.controllers.underConstruction=new a,n},c.Footer=function(...e){let n=o.a.controllers.underConstruction;return n.id=\"Footer\",o.a.controllers.list.pop(),n.sequence=Object(r.c)(e.map(e=>Object(r.c)(e._promises))),l=n,o.a.controllers.underConstruction=new a,n},define_ibex_controller({name:\"PennController\",jqueryWidget:{_init:function(){var e=this;o.a.controllers.running=e,e.cssPrefix=e.options._cssPrefix,e.utils=e.options._utils,e.finishedCallback=e.options._finishedCallback,e.id=e.options.id,e.runHeader=void 0==e.options.runHeader|e.options.runHeader,e.runFooter=void 0==e.options.runFooter|e.options.runFooter;let n=e.options.preloadDelay,t=[];e.save=function(n,o,r,i,s,...l){l.length||(l=[\"NULL\"]);let a=[[\"PennElementType\",n],[\"PennElementName\",o],[\"Parameter\",r],[\"Value\",i],[\"EventTime\",s]];if(e.options.appendResultLine instanceof Array)for(let n in e.options.appendResultLine){let t=e.options.appendResultLine[n];t instanceof Array&&2==t.length&&a.push(t)}a.push([\"Comments\",l.join(\",\")]),t.push(a)};for(let n in e.options.linesToSave)e.save(e.options.linesToSave[n]);e.runHeader&&s instanceof a&&(e.options.resources=e.options.resources.concat(s.resources.filter(n=>e.options.resources.indexOf(n)<0)),$.extend(e.options.elements,s.elements)),e.runFooter&&l instanceof a&&(e.options.resources=e.options.resources.concat(l.resources.filter(n=>e.options.resources.indexOf(n)<0)),$.extend(e.options.elements,l.elements));let i=!1,c=async function(){if(!i){i=!0,e.runFooter&&l instanceof a&&(e.save(\"PennController\",e.id,\"_Footer_\",\"Start\",Date.now(),\"NULL\"),await l.sequence(),e.save(\"PennController\",e.id,\"_Footer_\",\"End\",Date.now(),\"NULL\"));for(let n in e.options.elements)e.options.elements[n].end();e.save(\"PennController\",e.id,\"_Trial_\",\"End\",Date.now(),\"NULL\"),t.sort((e,n)=>e[4][1]>n[4][1]),t.map(e=>{for(let n in e)e[n][1]instanceof Function?e[n][1]=e[n][1]():e[n][1]&&\"Var\"==e[n][1].type&&(e[n][1]=e[n][1].value)}),e.finishedCallback(t)}};e.endTrial=c;let u=!1,d=async function(n){if(!u){if(u=!0,n)for(let n in e.options.resources.filter(e=>\"ready\"!=e.status))e.save(\"PennController\",e.id,\"_PreloadFailed_\",csv_url_encode(e.options.resources[n].name),Date.now(),\"NULL\");e.save(\"PennController\",e.id,\"_Trial_\",\"Start\",Date.now(),\"NULL\"),e.runHeader&&s instanceof a&&(e.save(\"PennController\",e.id,\"_Header_\",\"Start\",Date.now(),\"NULL\"),await s.sequence(),e.save(\"PennController\",e.id,\"_Header_\",\"End\",Date.now(),\"NULL\")),p.remove(),e.options.sequence().then(c)}},p=$(\"<div><p>Please wait while the resources are preloading</p><p>This may take up to \"+Object(r.d)(n)+\".</p></div>\");e.element.append(p);for(let n in e.options.resources){let t=e.options.resources[n],o=t.resolve;\"ready\"!=t.status&&(t.resolve=function(){o.apply(t),0==e.options.resources.filter(e=>\"ready\"!=e.status).length&&d()})}0==e.options.resources.filter(e=>\"ready\"!=e.status).length?d():setTimeout(function(){d(!0)},n)}},properties:{obligatory:[],countsForProgressBar:!0,htmlDescription:null}})},70:function(e,n,t){(function(e){e._AddElementType(\"Function\",function(e){this.immediate=function(e,n){this.function=n},this.uponCreation=function(e){e()},this.value=function(){return this.function.call()},this.actions={call:async function(n){await this.function.apply(this,[e.controllers.running.element]),n()}},this.test={is:function(e){let n=this.function.call();return void 0===e?!n:n==e}}})}).call(this,t(2).PennController)}});","extractedComments":[]}