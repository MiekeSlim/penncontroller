{"code":"!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=136)}({136:function(e,t){window.PennController._AddElementType(\"EyeTracker\",function(e){let t,n,o,i=!1,s=!1,r=[[],[]],l=!1,a=null;function u(e){for(var t,n={},o=(e+\"\").split(\"\"),i=[],s=o[0],r=256,l=1;l<o.length;l++)null!=n[s+(t=o[l])]?s+=t:(i.push(s.length>1?n[s]:s.charCodeAt(0)),n[s+t]=r,r++,s=t);i.push(s.length>1?n[s]:s.charCodeAt(0));for(l=0;l<i.length;l++)i[l]=String.fromCharCode(i[l]);return i.join(\"\")}function c(){if(window.webgazer&&t)return window.webgazer;e.debug.error(\"Tried to access the EyeTracker before it was set.\")}function h(e){e=!(!1===e),c().showFaceFeedbackBox(e),c().showFaceOverlay(e),c().showPredictionPoints(e),c().showVideo(e),$(\"#webgazerGazeDot\").css(\"pointer-events\",\"none\")}function p(e){let t=$(window).height(),n=$(window).width(),o=e[0],i=e[1],s=n/2,r=t/2,l=new Array(50);!function(e,t,n,o,i,s){for(x=0;x<50;x++){let r=i-n[x],l=s-o[x],a=Math.sqrt(r*r+l*l),u=t/2,c=0;a<=u&&a>-1?c=100-a/u*100:a>u?c=0:a>-1&&(c=100),e[x]=c}}(l,t,o,i,s,r);let a=function(e){let t=0;for(x=0;x<50;x++)t+=e[x];return t/=50}(l);return Math.round(a)}$(window.document).keypress(e=>{if(32==e.which){let e=$(\"<div>\").css({position:\"absolute\",background:\"green\",width:20,height:20,\"border-radius\":10,top:400,left:400});$(\"#bod\").append(e);let t=\"right\",n=\"none\",o=function(){let i=e.offset();if(\"right\"==t)e.offset({left:i.left+2,top:i.top}),i.left>700&&(t=\"left\");else if(\"left\"==t)e.offset({left:i.left-2,top:i.top}),i.left<200&&(t=\"none\",n=\"up\");else if(\"up\"==n)e.offset({left:i.left,top:i.top-2}),i.top<100&&(n=\"down\");else{if(\"down\"!=n)return;e.offset({left:i.left,top:i.top+2}),i.top>600&&(n=\"none\")}a({clientX:i.left,clientY:i.top}),setTimeout(o,5)};o()}});this.immediate=function(l,u,c){i||function(){o=e.utils.guidGenerator(),i=!0;let l=document.createElement(\"script\");l.setAttribute(\"src\",\"https://files.lab.florianschwarz.net/ibexfiles/webgazer/webgazer.js\"),document.head.appendChild(l);let u=()=>{if(window.webgazer){t=window.webgazer.setRegression(\"weightedRidge\").setTracker(\"clmtrackr\").setGazeListener((e,t)=>{s&&(r[0].push(e.x),r[1].push(e.y),r[0].length>50&&r[0].shift(),r[1].length>50&&r[1].shift()),n&&n.look(e,t)});let e=document.addEventListener;document.addEventListener=function(...t){\"mousemove\"!=t[0]||\"function\"!=typeof t[1]||a||(a=t[1]),e.apply(document,t)},t.begin().showPredictionPoints(!0),h(!1)}else setTimeout(u,100)};void 0===t&&u()}(),\"number\"==typeof l&&(void 0===u||\"number\"==typeof u&&void 0===c)&&(c=u,u=l,this.id=e.utils.guidGenerator()),this.span=Number(u),this.proportion=c},this.uponCreation=function(e){let t;this.enabled=!1,this.elements=[],this.counts={times:[]},this.callback=null,this.log=!1,this.trainOnMouseMove=!0,this.look=function(e,n){if(this.enabled&&null!=e&&void 0!==e.x&&void 0!==e.y){this.elements.map(e=>e.jQueryElement.removeClass(\"PennController-eyetracked\"));for(let t=0;t<this.elements.length;t++){let n=this.elements[t].jQueryElement,o=n.offset(),i=n.width(),s=n.height(),r=o.left<=e.x&&o.top<=e.y&&o.left+i>=e.x&&o.top+s>=e.y;if(r?this.counts[\"_\"+this.elements[t].id].push(1):this.counts[\"_\"+this.elements[t].id].push(0),isNaN(this.span))r&&(n.addClass(\"PennController-eyetracked\"),this.callback&&this.callback instanceof Function&&this.callback.call(this.elements[t],e.x,e.y));else{this.hasOwnProperty(\"gazes\")&&this.elements.length==this.gazes.length||(this.gazes=this.elements.map(()=>[])),r?this.gazes[t].push(!0):this.gazes[t].push(!1),this.gazes[t].length>this.span&&this.gazes[t].shift();let o=Number(this.proportion);isNaN(o)&&(o=this.span/100),o<=0?o=.01:o>=1&&(o=.99),this.gazes[t].filter(e=>e).length/this.gazes[t].length>o&&n.addClass(\"PennController-eyetracked\"),this.callback&&this.callback instanceof Function&&this.callback.call(this.elements[t],e.x,e.y)}}void 0===t&&(t=n),this.counts.times.push(Math.round(n-t)),t=n}},e()},this.end=function(){if(h(!1),c().removeMouseEventListeners(),this.enabled=!1,n=void 0,this.log&&this.counts.times.length){let t=\"https://files.lab.florianschwarz.net/ibexfiles/RecordingsFromIbex/trackerData.php\",n=window.location.href.replace(/[^\\/]+$/,\"\").replace(/[^\\w\\d]/g,\"\").replace(/[\\.]{2,}/g,\"\");e.debug.log(\"expname\",n);let i=(i,s)=>{let r={experiment:n,id:o,pcnumber:e.controllers.running.id,parameter:i,value:s},l=\"json=\"+JSON.stringify(r);var a=new XMLHttpRequest;a.open(\"POST\",t,!0),a.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded\"),a.onreadystatechange=(()=>{200!=a.status&&e.controllers.running.save(this.type,this.id,\"Upload\",\"Error\",Date.now(),i)}),a.send(l)};e.debug.log(\"about to send times\",this.counts),i(\"times\",u(this.counts.times.join(\".\"))),delete this.counts.times;let s=Object.keys(this.counts);for(let e=0;e<s.length;e++)i(s[e],u(this.counts[s[e]].join(\".\")));e.controllers.running.save(this.type,this.id,\"Filename\",n+\"/\"+o,Date.now(),\"NULL\")}delete this.counts},this.value=function(){return\"EyeTracker\"},this.actions={calibrate(t,n,o){Number(o)>0||(o=-1),function t(n,o,i,u){c().addMouseEventListeners(),o.trainOnMouseMove||document.removeEventListener(\"mousemove\",a,!0),e.debug.log(\"Starting calibration\"),r=[[],[]];let d=$(\"<div>\").css({position:\"absolute\",left:0,top:0,width:\"100vw\",height:\"100vh\",\"background-color\":\"white\",\"text-align\":\"center\"}),f=()=>{d.find(\"button\").remove(),d.append($(\"<button>+</button>\").css({position:\"absolute\",top:\"calc(50vh - 1.25vw)\",bottom:\"48.75vw\",width:\"2.5vw\",height:\"2.5vw\"}).click(function(){$(this).attr(\"disabled\",!0),s=!0,setTimeout(()=>{let a=p(r);e.debug.log(\"Tracker's precision: \"+a),s=!1,r=[[],[]],e.controllers.running.save(o.type,o.id,\"calibration\",a,Date.now(),1==u?\"Last attempt\":\"NULL\"),i&&Number(i)>0&&a<i&&1!=u?(l=!1,$(this).remove(),h(!0),d.append($(\"<div>\").html(\"<p>It looks like we were not able to precisely calibrate the tracker:</p><p>You calibration score is \"+a+\" and you need at least \"+i+\"</p><p>Here are a few tips to help you better self-calibrate:</p><p>- try adjusting your webcam based on the video in the top-left corner.</p><p>- if you use an external webcam, make sure it is fixed to the top of your screen.</p><p>- try raising your screen so as to align your webcam with your eyes</p><p><img style='display: inline-block; height: 75px;' src='http://files.lab.florianschwarz.net/ibexfiles/Pictures/lookdown.png'><img style='display: inline-block; height: 75px;' src='http://files.lab.florianschwarz.net/ibexfiles/Pictures/lookstraight.png'></p><p>- make sure no one is standing next to you.</p><p>- make sure you are not wearing eyeglasses reflecting ambiant light.</p><p>- make sure the algorithm detects your face (it should appear green).</p><p>- make sure there is enough ambient light for face-detection.</p><p>- make sure you follow your mouse pointer with your eyes.</p><p>- make sure you keep looking at the middle button until the end.</p>\").css({margin:\"auto\",\"margin-top\":\"5em\"})).append($(\"<button>Retry</button>\").click(function(){d.remove(),t(n,o,i,u-1)}).css(\"margin\",\"auto\"))):(l=!0,d.remove(),h(!1),c().removeMouseEventListeners(),n())},2e3)}))};if(l)f();else{let e=8,t=function(){$(this).attr(\"disabled\",!0),--e<=0&&f()};d.append($(\"<button>Start calibration</button>\").css({position:\"absolute\",top:\"calc(50vh - 2.5vw)\",left:\"47.5vw\",width:\"5vw\",height:\"5vw\"}).click(function(){$(this).remove(),h(!1),c().showPredictionPoints(!0),d.append($(\"<button>+</button>\").css({position:\"absolute\",top:0,left:0,width:\"2.5vw\",height:\"2.5vw\"}).click(t)).append($(\"<button>+</button>\").css({position:\"absolute\",top:0,right:0,width:\"2.5vw\",height:\"2.5vw\"}).click(t)).append($(\"<button>+</button>\").css({position:\"absolute\",bottom:0,left:0,width:\"2.5vw\",height:\"2.5vw\"}).click(t)).append($(\"<button>+</button>\").css({position:\"absolute\",bottom:0,right:0,width:\"2.5vw\",height:\"2.5vw\"}).click(t)).append($(\"<button>+</button>\").css({position:\"absolute\",top:\"calc(50vh - 1.25vw)\",left:0,width:\"2.5vw\",height:\"2.5vw\"}).click(t)).append($(\"<button>+</button>\").css({position:\"absolute\",top:0,left:\"48.75vw\",width:\"2.5vw\",height:\"2.5vw\"}).click(t)).append($(\"<button>+</button>\").css({position:\"absolute\",top:\"calc(50vh - 1.25vw)\",right:0,width:\"2.5vw\",height:\"2.5vw\"}).click(t)).append($(\"<button>+</button>\").css({position:\"absolute\",bottom:0,left:\"48.75vw\",width:\"2.5vw\",height:\"2.5vw\"}).click(t))})),h(!0)}$(\"#webgazerVideoFeed\").before(d)}(t,this,n,o)},hideFeedback:function(e){h(!1),e()},start:function(e){this.enabled=!0,n=this,e()},stop:function(e){this.enabled=!1,n=void 0,e()},stopTraining:function(e){c().removeMouseEventListeners(),c().showPredictionPoints(!1),e()},showFeedback:function(e){h(),e()},train:function(e,t){c().addMouseEventListeners(),this.trainOnMouseMove||document.removeEventListener(\"mousemove\",a,!0),c().showPredictionPoints(t),e()}},this.settings={add:function(e,...t){for(let e=0;e<t.length;e++){let n=t[e];n&&n._element&&this.elements.indexOf(n._element)<0&&(this.elements.push(n._element),this.counts[\"_\"+n._element.id]=[])}e()},callback:function(e,t){t instanceof Function&&(this.callback=t),e()},log:function(e){this.log=!0,e()},trainOnMouseMove:function(e,t){this.trainOnMouseMove=void 0===t||t,this.trainOnMouseMove||document.removeEventListener(\"mousemove\",a,!0),e()}}})}});","extractedComments":[]}